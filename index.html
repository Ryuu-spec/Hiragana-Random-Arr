<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arrange Random Hiragana</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Klee+One:wght@600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', Arial, sans-serif;
            background: #fdf0eb;
            padding: 20px;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            width: 1400px;
            height: 800px;
            margin: 0 auto;
            position: relative;
            transform-origin: top center;
        }
        
        @media (max-width: 1400px) {
            .container {
                transform: scale(calc(100vw / 1400));
            }
        }

        /* í—¤ë” */
        .header {
            background: #f9ddd0;
            border-radius: 25px;
            padding: 18px 35px;
            text-align: center;
            margin-bottom: 40px;
            position: relative;
            width: 1099px;
            margin-left: auto;
            margin-right: auto;
            box-shadow: 0 4px 0 #e8c4b0, 0 6px 15px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 30px;
        }

        .timer {
            position: absolute;
            right: 35px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 20px;
            font-weight: 700;
            color: #e86050;
            min-width: 80px;
            text-align: right;
        }

        .header h1 {
            font-size: 30px;
            font-weight: 800;
            color: #222;
            letter-spacing: 0.5px;
        }
        
        .reset-btn {
            padding: 6px 20px;
            background: #e86050;
            border: none;
            border-radius: 16px;
            color: #fff;
            font-size: 13px;
            font-weight: 700;
            cursor: pointer;
            transition: background 0.2s, transform 0.15s;
            box-shadow: 0 3px 0 #c84838, 0 5px 10px rgba(232,96,80,0.4);
        }
        
        .reset-btn:hover {
            background: #d04838;
            transform: scale(1.05);
        }
        
        .reset-btn:active {
            transform: scale(0.95);
        }

        /* ë³¸ë¬¸ ë ˆì´ì•„ì›ƒ */
        .content {
            display: flex;
            gap: 24px;
            align-items: flex-start;
            justify-content: center;
        }

        /* â”€â”€â”€ í…Œì´ë¸” ì˜ì—­ â”€â”€â”€ */
        .table-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        /* ììŒ í–‰ */
        .consonants {
            display: flex;
            gap: 10px;
            margin-left: 80px;
        }

        .consonant {
            width: 70px;
            height: 70px;
            background: #b8d8f0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 700;
            color: #2a2a2a;
            box-shadow: 0 4px 0 #95b8d4, 0 6px 12px rgba(0,0,0,0.15);
        }

        .consonant.empty {
            opacity: 0;
        }

        /* í…Œì´ë¸” ê·¸ë¦¬ë“œ */
        .table-grid {
            display: flex;
            gap: 10px;
        }

        /* ëª¨ìŒ ì—´ */
        .vowel-column {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .vowel {
            width: 70px;
            height: 70px;
            background: #b8d8f0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 700;
            color: #2a2a2a;
            box-shadow: 0 4px 0 #95b8d4, 0 6px 12px rgba(0,0,0,0.15);
        }

        /* ì…€ ì—´ */
        .cells-column {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .cell {
            width: 70px;
            height: 70px;
            background: #fff;
            border: none;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            font-weight: 600;
            font-family: 'Klee One', cursive;
            color: #333;
            box-shadow: 0 4px 0 #e8e8e8, 0 6px 12px rgba(0,0,0,0.15);
            transition: all 0.2s;
        }

        .cell.drag-over {
            box-shadow: 0 0 0 3px #f0a050, 0 4px 0 #e8e8e8, 0 6px 12px rgba(0,0,0,0.15);
            background: #fff8f0;
        }

        .cell.tap-target {
            box-shadow: 0 0 0 3px #f0a050, 0 4px 0 #e8e8e8, 0 6px 12px rgba(0,0,0,0.15);
            background: #fff8f0;
            cursor: pointer;
        }

        .cell.filled {
            background: #fff;
            box-shadow: 0 4px 0 #e8e8e8, 0 6px 12px rgba(0,0,0,0.15);
        }

        .cell.wrong-flash {
            background: #ffe0d8 !important;
            box-shadow: 0 0 0 3px #e86050, 0 4px 0 #e8e8e8, 0 6px 12px rgba(0,0,0,0.15) !important;
        }

        /* â”€â”€â”€ ì˜¤ë¥¸ìª½: ì¹´ë“œ + ë²„íŠ¼ â”€â”€â”€ */
        .right-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            padding-top: 130px;
        }

        /* ê³ ì • ë„¤ëª¨ í‹€ â€” í•­ìƒ ë³´ì´ë©° ê¸€ìê°€ ê·¸ ì•ˆì— í‘œì‹œ */
        .card-area {
            width: 115px;
            height: 115px;
            background: #fff;
            border: 3px solid #f0a050;
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 5px 0 #d08838, 0 7px 15px rgba(240,160,80,0.3);
        }

        .char-item {
            width: 100%;
            height: 100%;
            background: transparent;
            border: none;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            font-weight: 600;
            font-family: 'Klee One', cursive;
            color: #333;
            cursor: pointer;
            transition: background 0.15s, transform 0.15s;
            user-select: none;
            -webkit-user-select: none;
        }

        .char-item:hover {
            background: rgba(240,160,80,0.06);
        }

        .char-item.selected {
            background: #fff3e6;
        }

        .char-item.dragging {
            opacity: 0.45;
        }

        /* ë²„íŠ¼ */
        .shuffle-btn {
            width: 58px;
            height: 58px;
            background: #f0a050;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 26px;
            transition: background 0.2s, transform 0.15s;
            box-shadow: 0 4px 0 #d08838, 0 6px 15px rgba(240,160,80,0.4);
        }

        .shuffle-btn:hover {
            background: #e08a3a;
            transform: scale(1.08);
        }

        .shuffle-btn:active {
            transform: scale(0.95);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Arrange Random Hiragana</h1>
            <div class="timer" id="timer">00:00</div>
        </div>

        <div class="content">
            <div class="table-container">
                <div class="consonants" id="consonants"></div>
                <div class="table-grid" id="tableGrid"></div>
            </div>

            <div class="right-section">
                <button class="reset-btn" id="resetBtn">ì´ˆê¸°í™”</button>
                <div class="card-area" id="cardArea"></div>
                <button class="shuffle-btn" id="shuffleBtn" title="íŒ¨ìŠ¤ (ë‚˜ì¤‘ì— ë‹¤ì‹œ)">ğŸ‘†</button>
            </div>
        </div>
    </div>

    <script>
        const hiragana = {
            consonants: ['A','K','S','T','N','H','M','Y','R','W',''],
            vowels: ['a','i','u','e','o'],
            chars: {
                'A': ['ã‚','ã„','ã†','ãˆ','ãŠ'],
                'K': ['ã‹','ã','ã','ã‘','ã“'],
                'S': ['ã•','ã—','ã™','ã›','ã'],
                'T': ['ãŸ','ã¡','ã¤','ã¦','ã¨'],
                'N': ['ãª','ã«','ã¬','ã­','ã®'],
                'H': ['ã¯','ã²','ãµ','ã¸','ã»'],
                'M': ['ã¾','ã¿','ã‚€','ã‚','ã‚‚'],
                'Y': ['ã‚„','','ã‚†','','ã‚ˆ'],
                'R': ['ã‚‰','ã‚Š','ã‚‹','ã‚Œ','ã‚'],
                'W': ['ã‚','','','','ã‚’'],
                '':  ['','','','','ã‚“']
            }
        };

        let draggedElement = null;
        let remainingChars  = [];
        let gridCells       = {};
        let selectedCard    = null;
        let skippedChars    = [];  // íŒ¨ìŠ¤í•œ ê¸€ìë“¤
        let wrongChars      = [];  // í‹€ë¦° ê¸€ìë“¤
        let timerInterval   = null;  // íƒ€ì´ë¨¸ ì¸í„°ë²Œ
        let timerSeconds    = 0;     // ê²½ê³¼ ì‹œê°„ (ì´ˆ)
        let timerStarted    = false; // íƒ€ì´ë¨¸ ì‹œì‘ ì—¬ë¶€
        let totalChars      = 0;     // ì „ì²´ ë¬¸ì ê°œìˆ˜
        let completedChars  = 0;     // ì™„ë£Œí•œ ë¬¸ì ê°œìˆ˜

        // â”€â”€â”€ ì´ˆê¸°í™” â”€â”€â”€
        function initializeConsonants() {
            const container = document.getElementById('consonants');
            hiragana.consonants.forEach(c => {
                const el = document.createElement('div');
                el.className = 'consonant' + (c === '' ? ' empty' : '');
                el.textContent = c;
                container.appendChild(el);
            });
        }

        function initializeTable() {
            const grid = document.getElementById('tableGrid');

            const vowelCol = document.createElement('div');
            vowelCol.className = 'vowel-column';
            hiragana.vowels.forEach(v => {
                const el = document.createElement('div');
                el.className = 'vowel';
                el.textContent = v;
                vowelCol.appendChild(el);
            });
            grid.appendChild(vowelCol);

            hiragana.consonants.forEach(con => {
                const col = document.createElement('div');
                col.className = 'cells-column';

                hiragana.vowels.forEach((_, vi) => {
                    const char = hiragana.chars[con][vi];
                    const cell = document.createElement('div');
                    cell.className = 'cell';

                    if (char) {
                        cell.dataset.correct = char;
                        cell.addEventListener('dragover',  handleDragOver);
                        cell.addEventListener('dragleave', handleDragLeave);
                        cell.addEventListener('drop',      handleDrop);
                        cell.addEventListener('click',     handleCellClick);
                        gridCells[char] = cell;
                    } else {
                        cell.style.opacity       = '0';
                        cell.style.pointerEvents = 'none';
                    }
                    col.appendChild(cell);
                });
                grid.appendChild(col);
            });
        }

        function initializeCharacters() {
            const all = [];
            hiragana.consonants.forEach(con => {
                hiragana.chars[con].forEach(c => { if (c) all.push(c); });
            });
            for (let i = all.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [all[i], all[j]] = [all[j], all[i]];
            }
            remainingChars = all;
            totalChars = all.length;
        }

        // â”€â”€â”€ íƒ€ì´ë¨¸ í•¨ìˆ˜ë“¤ â”€â”€â”€
        function startTimer() {
            if (timerStarted) return;
            timerStarted = true;
            timerSeconds = 0;
            updateTimerDisplay();
            timerInterval = setInterval(() => {
                timerSeconds++;
                updateTimerDisplay();
            }, 1000);
        }

        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }

        function resetTimer() {
            stopTimer();
            timerStarted = false;
            timerSeconds = 0;
            updateTimerDisplay();
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timerSeconds / 60);
            const seconds = timerSeconds % 60;
            const display = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            document.getElementById('timer').textContent = display;
        }

        // â”€â”€â”€ ì¹´ë“œ í‘œì‹œ (í•˜ë‚˜ì”©) â”€â”€â”€
        function showNextCard() {
            if (remainingChars.length === 0) {
                // íŒ¨ìŠ¤í–ˆê±°ë‚˜ í‹€ë¦° ê¸€ìê°€ ìˆìœ¼ë©´ ë‹¤ì‹œ ì¶”ê°€
                if (skippedChars.length > 0 || wrongChars.length > 0) {
                    const retryChars = [...skippedChars, ...wrongChars];
                    // ì…”í”Œ
                    for (let i = retryChars.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [retryChars[i], retryChars[j]] = [retryChars[j], retryChars[i]];
                    }
                    remainingChars = retryChars;
                    skippedChars = [];
                    wrongChars = [];
                    alert('íŒ¨ìŠ¤í–ˆê±°ë‚˜ í‹€ë¦° ë¬¸ìë“¤ì„ ë‹¤ì‹œ ì‹œì‘í•©ë‹ˆë‹¤! ğŸ’ª');
                } else {
                    alert('ëª¨ë“  ë¬¸ìê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ‰');
                    return;
                }
            }
            const area = document.getElementById('cardArea');
            area.innerHTML = '';
            deselectCard();

            const char = remainingChars.shift();
            const card = document.createElement('div');
            card.className   = 'char-item';
            card.textContent = char;
            card.draggable   = true;
            card.dataset.char = char;
            card.dataset.char = char;

            card.addEventListener('dragstart', handleDragStart);
            card.addEventListener('dragend',   handleDragEnd);
            card.addEventListener('click',     handleCardClick);

            area.appendChild(card);
        }

        // â”€â”€â”€ ë§ˆìš°ìŠ¤ ë“œë˜ê·¸ â”€â”€â”€
        function handleDragStart(e) {
            draggedElement = e.currentTarget;
            draggedElement.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/plain', draggedElement.dataset.char);
        }

        function handleDragEnd(e) {
            e.currentTarget.classList.remove('dragging');
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('drag-over');
        }

        function handleDragLeave(e) {
            e.currentTarget.classList.remove('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            const cell = e.currentTarget;
            cell.classList.remove('drag-over');
            if (draggedElement) {
                attemptPlace(draggedElement, cell);
                draggedElement = null;
            }
        }

        // â”€â”€â”€ íƒ­ ì„ íƒ â”€â”€â”€
        function handleCardClick(e) {
            const card = e.currentTarget;
            if (selectedCard === card) { deselectCard(); return; }

            deselectCard();
            selectedCard = card;
            card.classList.add('selected');

            Object.values(gridCells).forEach(cell => {
                if (!cell.dataset.placed) cell.classList.add('tap-target');
            });
        }

        function handleCellClick(e) {
            const cell = e.currentTarget;
            if (!selectedCard)       return;
            if (cell.dataset.placed) return;

            attemptPlace(selectedCard, cell);
            deselectCard();
        }

        function deselectCard() {
            if (selectedCard) {
                selectedCard.classList.remove('selected');
                selectedCard = null;
            }
            Object.values(gridCells).forEach(cell => cell.classList.remove('tap-target'));
        }

        // â”€â”€â”€ ë°°ì¹˜ ì‹œë„ â”€â”€â”€
        function attemptPlace(source, targetCell) {
            const dropped = source.dataset.char;
            const correct = targetCell.dataset.correct;

            if (dropped === correct) {
                targetCell.textContent    = dropped;
                targetCell.classList.add('filled');
                targetCell.dataset.placed = dropped;
                completedChars++;
                
                // wrongCharsì™€ skippedCharsì—ì„œ í•´ë‹¹ ë¬¸ì ì œê±°
                const wrongIndex = wrongChars.indexOf(dropped);
                if (wrongIndex > -1) {
                    wrongChars.splice(wrongIndex, 1);
                }
                const skippedIndex = skippedChars.indexOf(dropped);
                if (skippedIndex > -1) {
                    skippedChars.splice(skippedIndex, 1);
                }
                
                // remainingCharsì—ì„œë„ ë™ì¼í•œ ë¬¸ì ëª¨ë‘ ì œê±°
                remainingChars = remainingChars.filter(c => c !== dropped);
                
                // ì¹´ë“œ ê¸€ìë§Œ ì œê±°, ë„¤ëª¨ í‹€ ìœ ì§€
                document.getElementById('cardArea').innerHTML = '';
                
                // ëª¨ë“  ë¬¸ìë¥¼ ì™„ë£Œí–ˆëŠ”ì§€ ì²´í¬
                if (completedChars === totalChars) {
                    stopTimer();
                    const minutes = Math.floor(timerSeconds / 60);
                    const seconds = timerSeconds % 60;
                    setTimeout(() => {
                        alert(`ğŸ‰ ì™„ë£Œ! ì†Œìš” ì‹œê°„: ${minutes}ë¶„ ${seconds}ì´ˆ`);
                    }, 300);
                } else {
                    // ë‹¤ìŒ ì¹´ë“œ í‘œì‹œ
                    showNextCard();
                }
            } else {
                // í‹€ë¦° ê¸€ìëŠ” wrongCharsì— ì¶”ê°€
                if (!wrongChars.includes(dropped)) {
                    wrongChars.push(dropped);
                }
                targetCell.classList.add('wrong-flash');
                setTimeout(() => targetCell.classList.remove('wrong-flash'), 350);
            }
        }
        
        // â”€â”€â”€ íŒ¨ìŠ¤ ë²„íŠ¼ í´ë¦­ ì‹œ í˜„ì¬ ê¸€ìë¥¼ skippedCharsì— ì¶”ê°€ â”€â”€â”€
        function skipCurrentChar() {
            // ì²« ë²ˆì§¸ í´ë¦­ ì‹œ íƒ€ì´ë¨¸ ì‹œì‘
            if (!timerStarted) {
                startTimer();
            }
            
            const currentCard = document.querySelector('.char-item');
            if (currentCard) {
                const char = currentCard.dataset.char;
                if (!skippedChars.includes(char)) {
                    skippedChars.push(char);
                }
            }
            // ì¹´ë“œê°€ ìˆë“  ì—†ë“  ë‹¤ìŒ ì¹´ë“œ í‘œì‹œ
            showNextCard();
        }
        
        // â”€â”€â”€ ì´ˆê¸°í™” í•¨ìˆ˜ â”€â”€â”€
        function resetGame() {
            // ëª¨ë“  ë°°ì¹˜ëœ ê¸€ì ì œê±°
            Object.values(gridCells).forEach(cell => {
                cell.textContent = '';
                cell.classList.remove('filled');
                delete cell.dataset.placed;
            });
            
            // ë°°ì—´ ì´ˆê¸°í™”
            skippedChars = [];
            wrongChars = [];
            remainingChars = [];
            completedChars = 0;
            
            // íƒ€ì´ë¨¸ ì´ˆê¸°í™”
            resetTimer();
            
            // ì¹´ë“œ ì˜ì—­ ë¹„ìš°ê¸°
            document.getElementById('cardArea').innerHTML = '';
            
            // ë¬¸ì ì¬ì´ˆê¸°í™”
            initializeCharacters();
            
            alert('ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ”„\nì†ê°€ë½ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‹œì‘í•˜ì„¸ìš”.');
        }

        // â”€â”€â”€ ì‹œì‘ â”€â”€â”€
        document.getElementById('shuffleBtn').addEventListener('click', skipCurrentChar);
        document.getElementById('resetBtn').addEventListener('click', resetGame);

        initializeConsonants();
        initializeTable();
        initializeCharacters();
        // ì²« ì¹´ë“œëŠ” ì†ê°€ë½ ë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œ í‘œì‹œ
    </script>
</body>
</html>
